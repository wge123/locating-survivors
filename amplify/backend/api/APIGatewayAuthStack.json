{
    "Description": "API Gateway policy stack created using Amplify CLI",
    "AWSTemplateFormatVersion": "2010-09-09",
    "Parameters": {
      "authRoleName": {
        "Type": "String"
      },
      "unauthRoleName": {
        "Type": "String"
      },
      "env": {
        "Type": "String"
      },
      "lsApi": {
        "Type": "String"
      }
    },
    "Conditions": {
      "ShouldNotCreateEnvResources": {
        "Fn::Equals": [
          {
            "Ref": "env"
          },
          "NONE"
        ]
      }
    },
    "Resources": {
      "PolicyAPIGWAuth1": {
        "Type": "AWS::IAM::ManagedPolicy",
        "Properties": {
          "PolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": [
                  "execute-api:Invoke"
                ],
                "Resource": [
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:execute-api:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":",
                        {
                          "Ref": "lsApi"
                        },
                        "/",
                        {
                          "Fn::If": [
                            "ShouldNotCreateEnvResources",
                            "Prod",
                            {
                              "Ref": "env"
                            }
                          ]
                        },
                        "/*/test/*"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:execute-api:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":",
                        {
                          "Ref": "lsApi"
                        },
                        "/",
                        {
                          "Fn::If": [
                            "ShouldNotCreateEnvResources",
                            "Prod",
                            {
                              "Ref": "env"
                            }
                          ]
                        },
                        "/*/test"
                      ]
                    ]
                  }
                ]
              }
            ]
          },
          "Roles": [
            {
              "Ref": "authRoleName"
            }
          ]
        }
      },
      "PolicyAPIGWUnauth1": {
        "Type": "AWS::IAM::ManagedPolicy",
        "Properties": {
          "PolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Action": [
                  "execute-api:Invoke"
                ],
                "Resource": [
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:execute-api:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":",
                        {
                          "Ref": "lsApi"
                        },
                        "/",
                        {
                          "Fn::If": [
                            "ShouldNotCreateEnvResources",
                            "Prod",
                            {
                              "Ref": "env"
                            }
                          ]
                        },
                        "/GET/test/*"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:aws:execute-api:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":",
                        {
                          "Ref": "lsApi"
                        },
                        "/",
                        {
                          "Fn::If": [
                            "ShouldNotCreateEnvResources",
                            "Prod",
                            {
                              "Ref": "env"
                            }
                          ]
                        },
                        "/GET/test"
                      ]
                    ]
                  }
                ]
              }
            ]
          },
          "Roles": [
            {
              "Ref": "unauthRoleName"
            }
          ]
        }
      }
    }
  }